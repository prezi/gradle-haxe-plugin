Gradle Haxe Plugin Manual
=========================

# Basics

## Workflow

The Haxe plugin consists of three parts:

* compilation and source bundling
* testing
* publishing

### Compilation

A `CompileHaxe` task will create two output artifacts:

* `output`: the compiled code, i.e. the `.js` or `.swf` file. You can use this output as is.
* `soruces`: the `.har` archive that you can use to link your module together with other projects on the source level.

Syntax:

	task compile(type: com.prezi.gradle.haxe.CompileHaxe) {
		source "<directory>"
		targetPlatform "<js|swf|as3>"

		// Optional parameters
		resource <directory>
		includePackage "<package|class>"
		excludePackage "<package|class>"
		outputFile <file>
		outputDirectory <directory>
		flag <flag>
		debug true|false
	}

Parameters:

* `source` -- specify a source directory. Repeat `source` clause for multiple source directories.
* `resource` -- specify a resource directory. Repeat `resource` clause for multiple resource directories.
* `includePackage`, `excludePackage` -- adds `--macro include('â€¦')` to the build path.
* `targetPlatform` -- specify the target platform.
* `output(File|Directory)` -- For JS and SWF use `outputFile`, for AS3 use `outputDirectory`. If not specified, defaults to `${project.name}-${classifier}.{targetPlatform}`.
* `flag` -- add flag on Haxe command path, such as `"-D node"` or `"--js-modern"`.
* `debug` -- well, debug.



### Testing

The `MUnit` task tests the results of a compilation task with [MassiveUnit](https://github.com/massiveinteractive/MassiveUnit). To set it up you need to provide two things:

	task munit(type: com.prezi.gradle.haxe.MUnit) {
		test <compile-task-name>
		testSource <directory-with-test-sources>
	}

# Examples

## Compilation: the `CompileHaxe` task

You have a project with the following source folders for separate platforms:

	/src/common  -- shared code for all platforms
	/src/js      -- JS-specific code (i.e. for Node.JS and browser)
	/src/node    -- code used only from Node.JS
	/src/browser -- code when used from a web browser
	/src/as      -- ActionScript-specific stuff

You can set up three builds for Node, web browser and AS as such:

	task compileBrowser(type: CompileHaxe) {
		targetPlatform "js"
		classifier "browser"
		configuration configurations.browser
		source "src/common"
		source "src/js"
		source "src/browser"
	}

	task compileNode(type: CompileHaxe) {
		targetPlatform "js"
		classifier "node"
		configuration configurations.node
		source "src/common"
		source "src/js"
		source "src/node"
	}

	task compileAS(type: CompileHaxe) {
		targetPlatform "swf"
		classifier "as"
		configuration configurations.as
		source "src/common"
		source "src/as"
	}

This will give you three `.har` archives, each containing sources from their respective source folders:

* `project-browser.har` -- `src/common`, `src/js`, `src/browser`
* `project-node.har` -- `src/common`, `src/js`, `src/node`
* `project-as.har` -- `src/common`, `src/as`

### Resources

TBD

### The `.har` archive

The `.har` archive includes everything needed to build your project:

	+- META-INF
	|   +- MANIFEST.MF  -- manifest describing the archive
	+- sources          -- all source files copied into one folder
	+- resources        -- all resources copied into one folder

Each compile task builds a `.har` artifact for one specific platform. This means if you want to build a project for JS and AS3 as well, you will end up with two archives. See example below.

### The `build` task

A task called `build` is automatically generated by the Haxe plugin that automatically depends on all `CompileHaxe` tasks. So in order to build everything in your project, you can simply issue

	gradle build

## Testing: the `MUnit` task

If you want to test your code with MUnit, you will need to define some test tasks. Keeping with the example above, here's how you could test the browser artifact:

	task munitBrowser(type: MUnit) {
		test compileBrowser
		testSource "test/common"
		testSource "test/some-tests-for-browser-only"
	}

You can then run the tests via

	gradle munitBrowser



### The `test` tasks

Similar to the auto-generated `build` task, the Haxe plugin also creates a catch-all task for all tasks of type `MUnit` called `test`. So to run all MUnit tests on your project you can go:

	gradle test

## Publishing

